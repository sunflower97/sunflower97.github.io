(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{4820:function(e,b,a){function c(a){return a&&"object"==typeof a&&"default"in a?a.default:a}var d=c(a(2870)),f=c(a(4063)),g=a(2189),h=a(3938),i=a(1619);function j(){return(j=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function k(a){return a._id.startsWith("drafts.")?a._id.slice(7):a._id}function l(b,c){var a=j({},b);return delete a._rev,i.applyPatch(a,c)}function m(){return Promise.resolve()}function n(){var a,b,c=(a=["*[_id == $id][0]"],b||(b=a.slice(0)),a.raw=b,a);return n=function(){return c},c}function o(b,c,a){if(!b.s){if(a instanceof p){if(!a.s)return void(a.o=o.bind(null,b,c));1&c&&(c=a.s),a=a.v}if(a&&a.then)return void a.then(o.bind(null,b,c),o.bind(null,b,2));b.s=c,b.v=a;var d=b.o;d&&d(b)}}var p=function(){function a(){}return a.prototype.then=function(e,f){var b=new a,c=this.s;if(c){var d=1&c?e:f;if(d){try{o(b,1,d(this.v))}catch(g){o(b,2,g)}return b}return this}return this.o=function(c){try{var a=c.v;1&c.s?o(b,1,e?e(a):a):f?o(b,1,f(a)):o(b,2,a)}catch(d){o(b,2,d)}},b},a}();function q(a){return a instanceof p&&1&a.s}var r=function(a){var c=a.projectId,d=a.dataset,b=a.token,f=a.documentLimit;try{return Promise.resolve(fetch("https://"+c+".api.sanity.io/v1/data/export/"+d,{credentials:"include",headers:b?{Authorization:"Bearer "+b}:void 0})).then(function(c){function b(d){var e,g,h=(function(a){if(!a)throw new Error("Failed to read body from response");var c,d=!1;function b(){d=!0,c&&c.cancel()}return new ReadableStream({start:function(e){c=a.getReader();var f=new TextDecoder,g="";c.read().then(function n(j){try{if(j.done)return d?Promise.resolve():0===(g=g.trim()).length?(e.close(),Promise.resolve()):(e.enqueue(JSON.parse(g)),e.close(),Promise.resolve());for(var a=(g+=f.decode(j.value,{stream:!0})).split("\n"),h=0;h<a.length-1;++h){var k=a[h].trim();if(0===k.length)return Promise.resolve();try{e.enqueue(JSON.parse(k))}catch(l){return e.error(l),b(),Promise.resolve()}}if(g=a[a.length-1],!c)return Promise.resolve();var i=function(e,b){try{var a=Promise.resolve(c.read()).then(function(a){n(a)})}catch(d){return b(d)}return a&&a.then?a.then(void 0,b):a}(0,function(a){e.error(a)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(m){return Promise.reject(m)}}).catch(function(a){return e.error(a)})},cancel:b})})(c.body).getReader(),b=[],a=function(e,f){do{var c,a=e();if(a&&a.then){if(!q(a)){c=!0;break}a=a.v}var b=f();if(q(b)&&(b=b.v),!b)return a}while(!b.then)var d=new p,g=o.bind(null,d,2);return(c?a.then(h):b.then(i)).then(void 0,g),d;function h(c){for(a=c;q(b=f())&&(b=b.v),b;){if(b.then)return void b.then(i).then(void 0,g);if((a=e())&&a.then){if(!q(a))return void a.then(h).then(void 0,g);a=a.v}}o(d,1,a)}function i(b){if(b){do{if((a=e())&&a.then){if(!q(a))return void a.then(h).then(void 0,g);a=a.v}if(q(b=f())&&(b=b.v),!b)return void o(d,1,a)}while(!b.then)b.then(i).then(void 0,g)}else o(d,1,a)}}(function(){return Promise.resolve(h.read()).then(function(c){var a;if((a=g=(e=c).value)&&"error"in a&&"object"==typeof a.error&&null!==a.error&&"description"in a.error&&"string"==typeof a.error.description&&!("_id"in a))throw new Error("Error streaming dataset: "+g.error);if(g&&!g._id.startsWith("_.")&&b.push(g),f&&b.length>f)throw h.cancel("Reached document limit"),new Error("Error streaming dataset: Reached limit of "+f+" documents")})},function(){return!e.done});return a&&a.then?a.then(function(a){return b}):b}var a=function(){if(200!==c.status)return Promise.resolve(c.json()).then(function(b){var a;throw new Error("Error streaming dataset: "+("object"==typeof(a=b)&&"error"in a&&"message"in a?a.message||a.error:"<unknown error>"))})}();return a&&a.then?a.then(b):b()})}catch(e){return Promise.reject(e)}};b.groq=d,b.groqStore=function(a){if(function(){var a=["EventSource","ReadableStream","fetch"].filter(function(a){return!(a in window)});if(a.length>0)throw new Error("Browser not supported. Missing browser APIs: "+a.join(", "))}(),a.token)throw new Error("`token` option not currently supported in browser");return function(a,c){var e,b=function(b,c){try{return Promise.resolve(i()).then(function(){var a=h.parse(b,{params:c});return Promise.resolve(h.evaluate(a,{dataset:o,params:c})).then(function(a){return a.get()})})}catch(a){return Promise.reject(a)}},i=function(){try{return e||(e=function(a,s,f){var h=f.getDocuments,i=f.EventSource,n=a.projectId,o=a.dataset,t=a.overlayDrafts,p=a.documentLimit;if(!a.listen)return{unsubscribe:m,loaded:h({projectId:n,dataset:o,documentLimit:p}).then(C).then(m)};var u,v,w,x,y,z,g,b,d,q,e,c,A=new Map,B=[],r=new Promise(function(a,b){v=a,w=b});return{unsubscribe:(g=i,b=a,d={next:function(a){var b,c;u?(function(b){if(b.effects&&!b.documentId.startsWith("_.")){var c,a,f,d,e,g=A.get(b.documentId)||null;c=b.documentId,a=l(g,b.effects.apply),f=A.get(c),d=u||[],e=f?d.indexOf(f):-1,-1===e&&a?(d.push(a),A.set(c,a)):a?(d.splice(e,1,a),A.set(c,a)):(d.splice(e,1),A.delete(c))}}(a),b=u,c=a,clearTimeout(z),y!==c.transactionId&&x?(C(x),y=void 0):(y=c.transactionId,x=b.slice()),z=setTimeout(C,25,b.slice())):B.push(a)},open:function(){try{return Promise.resolve(h({projectId:n,dataset:o,documentLimit:p})).then(function(d){var a,b,c;(u=(a=d,b=B,c=new Map,b.forEach(function(a){var b=c.get(a.documentId)||[];b.push(a),c.set(a.documentId,b)}),c.forEach(function(c,d){var b=a.find(function(a){return a._id===d});if(b){var f=!1,e=b;c.forEach(function(a){(f=f||a.previousRev===b._rev)&&a.effects&&(e=l(e,a.effects.apply))}),a.splice(a.indexOf(b),1,e)}else console.warn("Received mutation for missing document %s",d)}),a)).forEach(function(a){return A.set(a._id,a)}),C(u),v()})}catch(a){return Promise.reject(a)}},error:function(a){return w(a)}},e=b.token,(c=new g("https://"+b.projectId+".api.sanity.io/v1/data/listen/"+b.dataset+"?query=*&effectFormat=mendoza",{withCredentials:!0,headers:e?{Authorization:"Bearer "+e}:void 0})).addEventListener("welcome",d.open,!1),c.addEventListener("mutation",(q=d.next,function(b){var a;try{a=JSON.parse(b.data)}catch(c){return}q(a)}),!1),c.addEventListener("channelError",function(b){var a;c.close();try{a=JSON.parse(b.data)}catch(e){return void d.error(new Error("Unknown error parsing listener message"))}d.error(new Error(a.message||a.error||"Listener returned HTTP "+a.statusCode))},!1),c.addEventListener("error",function(b){var a,c="undefined"!=typeof window&&window.location.origin,e=(a=b,"object"==typeof a&&null!==a&&"message"in a)?" ("+b.message+")":"";d.error(new Error("Error establishing listener - check that the project ID and dataset are correct"+(c?", and that the CORS-origin ("+c+") is allowed":"")+e))},!1),{unsubscribe:function(){return Promise.resolve(c.close())}}).unsubscribe,loaded:r};function C(a){var b,c;x=void 0,z=void 0,y=void 0,s(t?(b=a,c=new Map,b.forEach(function(a){var b,d=c.get(k(a));a._id.startsWith("drafts.")?c.set(k(a),(b=a,j({},b,{_id:k(b)}))):d||c.set(a._id,a)}),Array.from(c.values())):a)}}(a,function(a){o=a,p()},c)),Promise.resolve(e.loaded).then(function(){})}catch(b){return Promise.reject(b)}},o=[],p=g.throttle(a.subscriptionThrottleMs||50,function(){q.forEach(r)}),q=[];function r(a){return b(a.query,a.params).then(function(b){"previousResult"in a&&f(a.previousResult,b)||(a.previousResult=b,a.callback(void 0,b))}).catch(function(b){a.callback(b)})}return{query:b,getDocument:function(c){try{return Promise.resolve(i()).then(function(){return b(d(n()),{id:c})})}catch(a){return Promise.reject(a)}},getDocuments:function(c){try{return Promise.resolve(i()).then(function(){var a=c.map(function(a){return'*[_id == "'+a+'"][0]'}).join(",\n");return b("["+a+"]")})}catch(a){return Promise.reject(a)}},subscribe:function(c,d,e){if(!a.listen)throw new Error("Cannot use `subscribe()` without `listen: true`");var b={query:c,params:d,callback:e};q.push(b);var f=!1;return r(b),{unsubscribe:function(){return f||(f=!0,q.splice(q.indexOf(b),1)),Promise.resolve()}}},close:function(){return p.cancel(),e?e.unsubscribe():Promise.resolve()}}}(a,{EventSource:window.EventSource,getDocuments:r})}},4063:function(a){"use strict";a.exports=function c(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(a.constructor!==b.constructor)return!1;if(Array.isArray(a)){if((g=a.length)!=b.length)return!1;for(e=g;0!=e--;)if(!c(a[e],b[e]))return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();if((g=(f=Object.keys(a)).length)!==Object.keys(b).length)return!1;for(e=g;0!=e--;)if(!Object.prototype.hasOwnProperty.call(b,f[e]))return!1;for(e=g;0!=e--;){var g,e,f,d=f[e];if(!c(a[d],b[d]))return!1}return!0}return a!=a&&b!=b}},3938:function(m,i,j){"use strict";j.r(i),j.d(i,{evaluate:function(){return aD},parse:function(){return aR}});var n=Object.defineProperty,o=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,r=(a,b,c)=>b in a?n(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,s=(c,a)=>{for(var b in a||(a={}))p.call(a,b)&&r(c,b,a[b]);if(o)for(var b of o(a))q.call(a,b)&&r(c,b,a[b]);return c};class t{constructor(a,b,c){this.allowBoost=!1,this.string=a,this.marks=b,this.index=0,this.parseOptions=c}hasMark(a=0){return this.index+a<this.marks.length}getMark(a=0){return this.marks[this.index+a]}shift(){this.index+=1}process(b){let a=this.marks[this.index];this.shift();let c=b[a.name];if(!c)throw new Error(`Unknown handler: ${a.name}`);return c.call(b,this,a)}processString(){return this.shift(),this.processStringEnd()}processStringEnd(){let a=this.marks[this.index-1],b=this.marks[this.index];return this.shift(),this.string.slice(a.position,b.position)}slice(b){let a=this.marks[this.index].position;return this.string.slice(a,a+b)}}let u=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function v(b,c){let a=b.toString();for(;a.length<c;)a=`0${a}`;return a}function w(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}class x{constructor(a){this.pattern=a,this.patternRe=function(c){let a=[];for(let b of c.split("."))"*"===b?a.push("[^.]+"):"**"===b?a.push(".*"):a.push(w(b));return new RegExp(`^${a.join(".")}$`)}(a)}matches(a){return this.patternRe.test(a)}toJSON(){return this.pattern}}class y{constructor(a){this.type="stream",this.generator=a,this.ticker=null,this.isDone=!1,this.data=[]}isArray(){return!0}async get(){let a=[];for await(let b of this)a.push(await b.get());return a}async *[Symbol.asyncIterator](){let a=0;for(;;){for(;a<this.data.length;a++)yield this.data[a];if(this.isDone)return;await this._nextTick()}}_nextTick(){if(this.ticker)return this.ticker;let c,a=()=>{this.ticker=new Promise(a=>{c=a})},d=()=>{c(),a()},b=async()=>{for await(let a of this.generator())this.data.push(a),d();this.isDone=!0,d()};return a(),b(),this.ticker}}class f{constructor(a,b){this.data=a,this.type=b}isArray(){return"array"===this.type}async get(){return this.data}[Symbol.asyncIterator](){if(Array.isArray(this.data))return function*(a){for(let b of a)yield F(b)}(this.data);throw new Error(`Cannot iterate over: ${this.type}`)}}let k=new f(null,"null"),z=new f(!0,"boolean"),A=new f(!1,"boolean");class B{constructor(a){this.date=a}static parseToValue(c){var a;let b=(a=c,u.test(a)?new Date(a):null);return b?new f(new B(b),"datetime"):k}equals(a){return this.date.getTime()==a.date.getTime()}add(b){let a=new Date(this.date.getTime());return a.setTime(a.getTime()+1e3*b),new B(a)}difference(a){return(this.date.getTime()-a.date.getTime())/1e3}compareTo(a){return this.date.getTime()-a.date.getTime()}toString(){return function(a){let d=v(a.getUTCFullYear(),4),e=v(a.getUTCMonth()+1,2),f=v(a.getUTCDate(),2),g=v(a.getUTCHours(),2),h=v(a.getUTCMinutes(),2),i=v(a.getUTCSeconds(),2),b="",c=a.getMilliseconds();return 0!=c&&(b=`.${v(c,3)}`),`${d}-${e}-${f}T${g}:${h}:${i}${b}Z`}(this.date)}toJSON(){return this.toString()}}function C(a){return Number.isFinite(a)?new f(a,"number"):k}function D(a){return new f(a,"string")}function E(a){return new f(a,"datetime")}function F(a){var b;return(b=a)&&"function"==typeof b.next?new y(async function*(){for await(let b of a)yield F(b)}):null==a?k:new f(a,G(a))}function G(a){return null==a?"null":Array.isArray(a)?"array":a instanceof x?"path":a instanceof B?"datetime":typeof a}let H={datetime:1,number:2,string:3,boolean:4};function I(a,b){let c=G(a),d=G(b);if(c!==d)return null;switch(c){case"number":case"boolean":return a-b;case"string":if(a<b)return -1;if(a>b)return 1;return 0;case"datetime":return a.compareTo(b);default:return null}}function J(b,c){let f=G(b),g=G(c),d=H[f]||100,e=H[g]||100;if(d!==e)return d-e;let a=I(b,c);return null===a&&(a=0),a}let K=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,L=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,M=/(\b\.+|\.+\b)/g;function N(a){return a.replace(M,"").match(K)||[]}function O(a){let b=a.replace(M,"").match(L)||[];return b.map(a=>new RegExp(`^${a.slice(0,1024).replace(/\*/g,".*")}$`,"i"))}async function P(a,b){if("string"===a.type)return b(a.data),!0;if(a.isArray()){let c=!0;for await(let d of a)"string"===d.type?b(d.data):c=!1;return c}return!1}async function Q(a,b,c){if("OpCall"===a.type&&"match"===a.op)return R(a.left,a.right,b,c);if("FuncCall"===a.type&&"boost"===a.name){let d=await Q(a.args[0],b,c),e=await c(a.args[1],b);return"number"===e.type&&d>0?d+e.data:0}switch(a.type){case"Or":{let i=await Q(a.left,b,c),j=await Q(a.right,b,c);return i+j}case"And":{let f=await Q(a.left,b,c),g=await Q(a.right,b,c);if(0===f||0===g)return 0;return f+g}default:{let h=await c(a,b);return"boolean"===h.type&& !0===h.data?1:0}}}async function R(g,h,a,b){let i=await b(g,a),j=await b(h,a),c=[],d=[];await P(i,a=>{c=c.concat(N(a))});let k=await P(j,a=>{d=d.concat(O(a))});if(!k)return 0;if(0===c.length||0===d.length)return 0;let e=0;for(let l of d){let f=c.reduce((a,b)=>a+(l.test(b)?1:0),0);e+=2.2*f/(f+1.2)}return e}async function S(a){if("object"===a.type)return U(a.data);if(a.isArray()){let b=await T(a);if(b.length>0)return b.join("\n\n")}return null}async function T(d,b=[]){for await(let a of d)if("object"===a.type){let c=U(a.data);null!==c&&b.push(c)}else a.isArray()&&await T(a,b);return b}function U(b){if("string"!=typeof b._type)return null;let c=b.children;if(!Array.isArray(c))return null;let d="";for(let a of c)a&&"object"==typeof a&&"string"==typeof a._type&&"span"===a._type&&"string"==typeof a.text&&(d+=a.text);return d}function V(a,b){switch(G(a)){case"array":for(let c of a)if(V(c,b))return!0;break;case"object":if(a._ref)return b.has(a._ref);for(let d of Object.values(a))if(V(d,b))return!0}return!1}let a={};a.coalesce=async function(b,c,d){for(let e of b){let a=await d(e,c);if("null"!==a.type)return a}return k},a.count=async function(c,d,e){let a=await e(c[0],d);if(!a.isArray())return k;let b=0;for await(let f of a)b++;return C(b)},a.count.arity=1,a.dateTime=async function(b,c,d){let a=await d(b[0],c);return"datetime"===a.type?a:"string"!==a.type?k:B.parseToValue(a.data)},a.dateTime.arity=1,a.defined=async function(a,b,c){let d=await c(a[0],b);return"null"===d.type?A:z},a.defined.arity=1,a.identity=async function(b,a){return D(a.context.identity)},a.identity.arity=0,a.length=async function(c,d,e){let a=await e(c[0],d);if("string"===a.type)return C(function(b){let c=0;for(let a=0;a<b.length;a++){let d=b.charCodeAt(a);(!(d>=55296)||!(d<=56319))&&c++}return c}(a.data));if(a.isArray()){let b=0;for await(let f of a)b++;return C(b)}return k},a.length.arity=1,a.path=async function(c,d,e){var a;let b=await e(c[0],d);return"string"!==b.type?k:(a=new x(b.data),new f(a,"path"))},a.path.arity=1,a.string=async function(b,c,d){let a=await d(b[0],c);switch(a.type){case"number":case"string":case"boolean":case"datetime":return D(`${a.data}`);default:return k}},a.string.arity=1,a.references=async function(e,c,f){let a=new Set;for(let g of e){let b=await f(g,c);if("string"===b.type)a.add(b.data);else if(b.isArray())for await(let d of b)"string"===d.type&&a.add(d.data)}if(0===a.size)return A;let h=await c.value.get();return V(h,a)?z:A},a.references.arity=a=>a>=1,a.round=async function(c,e,f){let g=await f(c[0],e);if("number"!==g.type)return k;let a=g.data,d=0;if(2===c.length){let b=await f(c[1],e);if("number"!==b.type||b.data<0||!Number.isInteger(b.data))return k;d=b.data}return 0===d?a<0?C(-Math.round(-a)):C(Math.round(a)):C(Number(a.toFixed(d)))},a.round.arity=a=>a>=1&&a<=2,a.now=async function(b,a){return D(a.context.timestamp.toISOString())},a.now.arity=0,a.boost=async function(){throw new Error("unexpected boost call")},a.boost.arity=2;let c={};c.lower=async function(b,c,d){let a=await d(b[0],c);return"string"!==a.type?k:D(a.data.toLowerCase())},c.lower.arity=1,c.upper=async function(b,c,d){let a=await d(b[0],c);return"string"!==a.type?k:D(a.data.toUpperCase())},c.upper.arity=1,a.lower=c.lower,a.upper=c.upper;let g={};g.text=async function(b,c,d){let e=await d(b[0],c),a=await S(e);return null===a?k:D(a)},g.text.arity=1;let h={};h.projectId=async function(b,a){return a.context.sanity?D(a.context.sanity.projectId):k},h.dataset=async function(b,a){return a.context.sanity?D(a.context.sanity.dataset):k};let e={};e.order=async function(d,l,m,n){if(await (!0),!d.isArray())return k;let e=[],o=[],f=0;for(let a of l){let g="asc";"Desc"===a.type?(g="desc",a=a.base):"Asc"===a.type&&(a=a.base),e.push(a),o.push(g),f++}let b=[],h=0;for await(let i of d){let p=m.createNested(i),j=[await i.get(),h];for(let c=0;c<f;c++){let q=await n(e[c],p);j.push(await q.get())}b.push(j),h++}return b.sort((c,d)=>{for(let a=0;a<f;a++){let b=J(c[a+2],d[a+2]);if("desc"===o[a]&&(b=-b),0!==b)return b}return c[1]-d[1]}),F(b.map(a=>a[0]))},e.order.arity=a=>a>=1,e.score=async function(c,e,f,g){if(!c.isArray())return k;let h=[],b=[];for await(let a of c){if("object"!==a.type){h.push(await a.get());continue}let i=f.createNested(a),d="number"==typeof a.data._score?a.data._score:0;for(let j of e)d+=await Q(j,i,g);let l=Object.assign({},a.data,{_score:d});b.push(l)}return b.sort((a,b)=>b._score-a._score),F(b)},e.score.arity=a=>a>=1;let b={};b.operation=async function(d,a){let b=null!==a.context.before,c=null!==a.context.after;return b&&c?D("update"):c?D("create"):b?D("delete"):k},b.changedAny=()=>{throw new Error("not implemented")},b.changedAny.arity=1,b.changedAny.mode="delta",b.changedOnly=()=>{throw new Error("not implemented")},b.changedOnly.arity=1,b.changedOnly.mode="delta";let d={};d.changedAny=()=>{throw new Error("not implemented")},d.changedAny.arity=3,d.changedOnly=()=>{throw new Error("not implemented")},d.changedOnly.arity=3;let W={global:a,string:c,pt:g,delta:b,diff:d,sanity:h},X=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,Y=/^\d+/,Z=/^[a-zA-Z_][a-zA-Z_0-9]*/,$=1,_=2,aa=3,ab=4,ac=6,ad=6,ae=7,af=7,ag=7,ah=8,ai=10,aj=10,ak=8;function al(b,a,g){let e=a,R=b[a],c;switch(R){case"+":{let k=al(b,aq(b,a+1),ai);if("error"===k.type)return k;c=[{name:"pos",position:e}].concat(k.marks),a=k.position;break}case"-":{let l=al(b,aq(b,a+1),ak);if("error"===l.type)return l;c=[{name:"neg",position:e}].concat(l.marks),a=l.position;break}case"(":{let h=al(b,aq(b,a+1),0);if("error"===h.type)return h;switch(a=aq(b,h.position),b[a]){case",":for(c=[{name:"tuple",position:e}].concat(h.marks),a=aq(b,a+1);;){if("error"===(h=al(b,a,0)).type)return h;if(a=aq(b,h.position),","!==b[a])break;a=aq(b,a+1)}if(")"!==b[a])return{type:"error",position:a};a++,c.push({name:"tuple_end",position:a});break;case")":a++,c=[{name:"group",position:e}].concat(h.marks);break;default:return{type:"error",position:a}}break}case"!":{let m=al(b,aq(b,a+1),aj);if("error"===m.type)return m;c=[{name:"not",position:e}].concat(m.marks),a=m.position;break}case"{":{let n=ao(b,a);if("error"===n.type)return n;c=n.marks,a=n.position;break}case"[":if(c=[{name:"array",position:a}],a=aq(b,a+1),"]"!==b[a])for(;;){"..."===b.slice(a,a+3)&&(c.push({name:"array_splat",position:a}),a=aq(b,a+3));let o=al(b,a,0);if("error"===o.type)return o;if(c=c.concat(o.marks),a=o.position,a=aq(b,a),","!==b[a])break;if(a=aq(b,a+1),"]"===b[a])break}if("]"!==b[a])return{type:"error",position:a};a++,c.push({name:"array_end",position:a});break;case"'":case'"':{let p=ap(b,a);if("error"===p.type)return p;c=p.marks,a=p.position;break}case"^":for(a++,c=[];"."===b[a]&&"^"===b[a+1];)c.push({name:"dblparent",position:e}),a+=2;c.push({name:"parent",position:e});break;case"@":c=[{name:"this",position:e}],a++;break;case"*":c=[{name:"everything",position:e}],a++;break;case"$":{let J=ar(b,a+1,Z);J&&(a+=1+J,c=[{name:"param",position:e},{name:"ident",position:e+1},{name:"ident_end",position:a}]);break}default:{let K=ar(b,a,Y);if(K){let q="integer";if("."===b[a+=K]){let L=ar(b,a+1,Y);L&&(q="float",a+=1+L)}if("e"===b[a]||"E"===b[a]){q="sci",("+"===b[++a]||"-"===b[a])&&a++;let M=ar(b,a,Y);if(!M)return{type:"error",position:a};a+=M}c=[{name:q,position:e},{name:q+"_end",position:a}];break}let N=ar(b,a,Z);if(N){switch(b[a+=N]){case":":case"(":{let r=an(b,e,a);if("error"===r.type)return r;c=r.marks,a=r.position;break}default:c=[{name:"this_attr",position:e},{name:"ident",position:e},{name:"ident_end",position:a}]}break}}}if(!c)return{type:"error",position:a};let f=12,i;loop:for(;;){let d=aq(b,a);if(d===b.length){a=d;break}if("success"===(i=am(b,d)).type){for(c.unshift({name:"traverse",position:e});"success"===i.type;)c=c.concat(i.marks),a=i.position,i=am(b,aq(b,a));c.push({name:"traversal_end",position:a});continue}let S=b[d];switch(S){case"=":{let T=b[d+1];switch(T){case">":{if(g>$||f<=$)break loop;let s=al(b,aq(b,d+2),$);if("error"===s.type)return s;(c=c.concat(s.marks)).unshift({name:"pair",position:e}),a=s.position,f=$;break}case"=":{if(g>ab||f<=ab)break loop;let t=al(b,aq(b,d+2),5);if("error"===t.type)return t;c.unshift({name:"comp",position:e}),c.push({name:"op",position:d},{name:"op_end",position:d+2}),c=c.concat(t.marks),a=t.position,f=ab;break}default:break loop}break}case"+":{if(g>ac||f<ac)break loop;let u=al(b,aq(b,d+1),ac+1);if("error"===u.type)return u;(c=c.concat(u.marks)).unshift({name:"add",position:e}),a=u.position,f=ac;break}case"-":{if(g>ad||f<ad)break loop;let v=al(b,aq(b,d+1),ad+1);if("error"===v.type)return v;(c=c.concat(v.marks)).unshift({name:"sub",position:e}),a=v.position,f=ad;break}case"*":{if("*"===b[d+1]){if(g>ah||f<=ah)break loop;let w=al(b,aq(b,d+2),ah);if("error"===w.type)return w;(c=c.concat(w.marks)).unshift({name:"pow",position:e}),a=w.position,f=ah;break}if(g>ae||f<ae)break loop;let x=al(b,aq(b,d+1),ae+1);if("error"===x.type)return x;(c=c.concat(x.marks)).unshift({name:"mul",position:e}),a=x.position,f=ae;break}case"/":{if(g>af||f<af)break loop;let y=al(b,aq(b,d+1),af+1);if("error"===y.type)return y;(c=c.concat(y.marks)).unshift({name:"div",position:e}),a=y.position,f=af;break}case"%":{if(g>ag||f<ag)break loop;let z=al(b,aq(b,d+1),ag+1);if("error"===z.type)return z;(c=c.concat(z.marks)).unshift({name:"mod",position:e}),a=z.position,f=ag;break}case"<":case">":{if(g>ab||f<=ab)break loop;let A=d+1;"="===b[A]&&A++;let B=al(b,aq(b,A),ab+1);if("error"===B.type)return B;c.unshift({name:"comp",position:e}),c.push({name:"op",position:d},{name:"op_end",position:A}),c=c.concat(B.marks),a=B.position,f=ab;break}case"|":if("|"===b[d+1]){if(g>_||f<_)break loop;let C=al(b,aq(b,d+2),_+1);if("error"===C.type)return C;(c=c.concat(C.marks)).unshift({name:"or",position:e}),a=C.position,f=_}else{if(g>11||f<11)break loop;let D=aq(b,d+1),O=ar(b,D,Z);if(!O)return{type:"error",position:D};if("("===b[a=D+O]||":"===b[a]){let E=an(b,D,a);if("error"===E.type)return E;(c=c.concat(E.marks)).unshift({name:"pipecall",position:e}),a=E.position,f=11}}break;case"&":{if("&"!=b[d+1])break loop;if(g>aa||f<aa)break loop;let F=al(b,aq(b,d+2),aa+1);if("error"===F.type)return F;(c=c.concat(F.marks)).unshift({name:"and",position:e}),a=F.position,f=aa;break}case"!":{if("="!==b[d+1])break loop;if(g>ab||f<ab)break loop;let G=al(b,aq(b,d+2),ab+1);if("error"===G.type)return G;c.unshift({name:"comp",position:e}),c.push({name:"op",position:d},{name:"op_end",position:d+2}),c=c.concat(G.marks),a=G.position,f=ab;break}case"d":if("desc"!==b.slice(d,d+4))break loop;if(g>4||f<4)break loop;c.unshift({name:"desc",position:e}),a=d+4,f=4;break;case"a":if("asc"!==b.slice(d,d+3))break loop;if(g>4||f<4)break loop;c.unshift({name:"asc",position:e}),a=d+3,f=4;break;default:{let U=as(b,d,Z);switch(U){case"in":{if(g>ab||f<=ab)break loop;a=aq(b,d+2);let P=!1;"("===b[a]&&(P=!0,a=aq(b,a+1));let V=a,j=al(b,a,ab+1);if("error"===j.type)return j;if(a=aq(b,j.position),"."===b[a]&&"."===b[a+1]){let Q="inc_range";"."===b[a+2]?(Q="exc_range",a=aq(b,a+3)):a=aq(b,a+2);let H=al(b,a,ab+1);if("error"===H.type)return H;c.unshift({name:"in_range",position:e}),c=c.concat({name:Q,position:V},j.marks,H.marks),a=H.position}else c.unshift({name:"comp",position:e}),c.push({name:"op",position:d},{name:"op_end",position:d+2}),c=c.concat(j.marks);if(P){if(a=aq(b,a),")"!==b[a])return{type:"error",position:a};a++}f=ab;break}case"match":{if(g>ab||f<=ab)break loop;let I=al(b,aq(b,d+5),ab+1);if("error"===I.type)return I;c.unshift({name:"comp",position:e}),c.push({name:"op",position:d},{name:"op_end",position:d+5}),c=c.concat(I.marks),a=I.position,f=4;break}default:break loop}}}}let W=(null==i?void 0:i.type)==="error"&&i.position;return{type:"success",marks:c,position:a,failPosition:W}}function am(b,a){let c=a;switch(b[a]){case".":{let m=a=aq(b,a+1),i=ar(b,a,Z);if(!i)return{type:"error",position:a};return{type:"success",marks:[{name:"attr_access",position:c},{name:"ident",position:m},{name:"ident_end",position:a+=i}],position:a}}case"-":if(">"!==b[a+1])return{type:"error",position:a};let j=[{name:"deref",position:c}],e=aq(b,a+=2),k=ar(b,e,Z);return k&&(a=e+k,j.push({name:"deref_attr",position:e},{name:"ident",position:e},{name:"ident_end",position:a})),{type:"success",marks:j,position:a};case"[":{if(a=aq(b,a+1),"]"===b[a])return{type:"success",marks:[{name:"array_postfix",position:c}],position:a+1};let n=a,d=al(b,a,0);if("error"===d.type)return d;if(a=aq(b,d.position),"."===b[a]&&"."===b[a+1]){let l="inc_range";"."===b[a+2]?(l="exc_range",a+=3):a+=2,a=aq(b,a);let f=al(b,a,0);if("error"===f.type)return f;if(a=aq(b,f.position),"]"!==b[a])return{type:"error",position:a};return{type:"success",marks:[{name:"slice",position:c},{name:l,position:n}].concat(d.marks,f.marks),position:a+1}}if("]"!==b[a])return{type:"error",position:a};return{type:"success",marks:[{name:"square_bracket",position:c}].concat(d.marks),position:a+1}}case"|":if(a=aq(b,a+1),"{"===b[a]){let g=ao(b,a);if("error"===g.type)return g;return g.marks.unshift({name:"projection",position:c}),g}break;case"{":{let h=ao(b,a);if("error"===h.type)return h;return h.marks.unshift({name:"projection",position:c}),h}}return{type:"error",position:a}}function an(b,e,a){let c=[];if(c.push({name:"func_call",position:e}),":"===b[a]&&":"===b[a+1]){c.push({name:"namespace",position:e}),c.push({name:"ident",position:e},{name:"ident_end",position:a}),a=aq(b,a+2);let f=ar(b,a,Z);if(!f)return{type:"error",position:a};if(c.push({name:"ident",position:a},{name:"ident_end",position:a+f}),a=aq(b,a+f),"("!==b[a])return{type:"error",position:a};a++}else c.push({name:"ident",position:e},{name:"ident_end",position:a}),a=aq(b,a+1);let g=a;if(")"!==b[a])for(;;){let d=al(b,a,0);if("error"===d.type)return d;if(c=c.concat(d.marks),g=d.position,a=aq(b,d.position),","!==b[a])break;if(a=aq(b,a+1),")"===b[a])break}return")"!==b[a]?{type:"error",position:a}:(c.push({name:"func_args_end",position:g}),{type:"success",marks:c,position:a+1})}function ao(b,a){let c=[{name:"object",position:a}];for(a=aq(b,a+1);"}"!==b[a];){let g=a;if("..."===b.slice(a,a+3)){if(a=aq(b,a+3),"}"!==b[a]&&","!==b[a]){let e=al(b,a,0);if("error"===e.type)return e;c.push({name:"object_splat",position:g}),c=c.concat(e.marks),a=e.position}else c.push({name:"object_splat_this",position:g})}else{let d=al(b,a,0);if("error"===d.type)return d;let h=aq(b,d.position);if("str"===d.marks[0].name&&":"===b[h]){let f=al(b,aq(b,h+1),0);if("error"===f.type)return f;c.push({name:"object_pair",position:g}),c=c.concat(d.marks,f.marks),a=f.position}else c=c.concat({name:"object_expr",position:a},d.marks),a=d.position}if(a=aq(b,a),","!==b[a])break;a=aq(b,a+1)}return"}"!==b[a]?{type:"error",position:a}:(a++,c.push({name:"object_end",position:a}),{type:"success",marks:c,position:a})}function ap(c,a){let d=c[a];a+=1;let b=[{name:"str",position:a}];str:for(;;a++){if(a>c.length)return{type:"error",position:a};switch(c[a]){case d:b.push({name:"str_end",position:a}),a++;break str;case"\\":b.push({name:"str_pause",position:a}),"u"===c[a+1]?"{"===c[a+2]?(b.push({name:"unicode_hex",position:a+3}),a=c.indexOf("}",a+3),b.push({name:"unicode_hex_end",position:a}),a++):(b.push({name:"unicode_hex",position:a+2}),b.push({name:"unicode_hex_end",position:a+6}),a+=5):(b.push({name:"single_escape",position:a+1}),a+=1),b.push({name:"str_start",position:a+1})}}return{type:"success",marks:b,position:a}}function aq(b,a){return a+ar(b,a,X)}function ar(b,c,d){let a=d.exec(b.slice(c));return a?a[0].length:0}function as(b,c,d){let a=d.exec(b.slice(c));return a?a[0]:null}function at(a,b){return c=>b(a(c))}function au(a){return b=>({type:"Map",base:b,expr:a({type:"This"})})}function av(b,a){if(!a)return{type:"a-a",build:b};switch(a.type){case"a-a":return{type:"a-a",build:at(b,a.build)};case"a-b":return{type:"a-b",build:at(b,a.build)};case"b-b":return{type:"a-a",build:at(b,au(a.build))};case"b-a":var c;return{type:"a-a",build:at(b,(c=a.build,a=>({type:"FlatMap",base:a,expr:c({type:"This"})})))};default:throw new Error(`unknown type: ${a.type}`)}}function aw(b,a){if(!a)return{type:"b-b",build:b};switch(a.type){case"a-a":case"b-a":return{type:"b-a",build:at(b,a.build)};case"a-b":case"b-b":return{type:"b-b",build:at(b,a.build)};default:throw new Error(`unknown type: ${a.type}`)}}let ax=function(a,b){return"string"===a.type&&"string"===b.type||"boolean"===a.type&&"boolean"===b.type||"null"===a.type&&"null"===b.type||"number"===a.type&&"number"===b.type?a.data===b.data:"datetime"===a.type&&"datetime"===b.type&&a.data.equals(b.data)},ay={"==":function(a,b){return ax(a,b)?z:A},"!=":function(a,b){return ax(a,b)?A:z},">":function(a,b){if("stream"===a.type||"stream"===b.type)return k;let c=I(a.data,b.data);return null===c?k:c>0?z:A},">=":function(a,b){if("stream"===a.type||"stream"===b.type)return k;let c=I(a.data,b.data);return null===c?k:c>=0?z:A},"<":function(a,b){if("stream"===a.type||"stream"===b.type)return k;let c=I(a.data,b.data);return null===c?k:c<0?z:A},"<=":function(a,b){if("stream"===a.type||"stream"===b.type)return k;let c=I(a.data,b.data);return null===c?k:c<=0?z:A},in:async function(b,a){if("path"===a.type)return"string"!==b.type?k:a.data.matches(b.data)?z:A;if(a.isArray()){for await(let c of a)if(ax(b,c))return z;return A}return k},match:async function(c,d){var b,a;let e=[],f=[];await P(c,a=>{e=e.concat(N(a))});let g=await P(d,a=>{f=f.concat(function(a){let b=O(a);return b.map(a=>b=>b.some(b=>a.test(b)))}(a))});if(!g)return A;let h=(b=e,a=f,0!==b.length&&0!==a.length&&a.every(a=>a(b)));return h?z:A},"+":function(a,b){return"datetime"===a.type&&"number"===b.type?E(a.data.add(b.data)):"number"===a.type&&"number"===b.type?C(a.data+b.data):"string"===a.type&&"string"===b.type?D(a.data+b.data):"object"===a.type&&"object"===b.type?F(s(s({},a.data),b.data)):"array"===a.type&&"array"===b.type?F(a.data.concat(b.data)):a.isArray()&&b.isArray()?new y(async function*(){for await(let c of a)yield c;for await(let d of b)yield d}):k},"-":function(a,b){return"datetime"===a.type&&"number"===b.type?E(a.data.add(-b.data)):"datetime"===a.type&&"datetime"===b.type?C(a.data.difference(b.data)):"number"===a.type&&"number"===b.type?C(a.data-b.data):k},"*":az((a,b)=>a*b),"/":az((a,b)=>a/b),"%":az((a,b)=>a%b),"**":az((a,b)=>Math.pow(a,b))};function az(a){return function(b,c){if("number"===b.type&&"number"===c.type){let d=a(b.data,c.data);return C(d)}return k}}class l{constructor(a,b,c,d,e){this.isHidden=!1,this.params=a,this.source=b,this.value=c,this.context=d,this.parent=e}createNested(a){return this.isHidden?new l(this.params,this.source,a,this.context,this.parent):new l(this.params,this.source,a,this.context,this)}createHidden(b){let a=this.createNested(b);return a.isHidden=!0,a}}function aA(a,b,c=aA){let d=aC[a.type];return d(a,b,c)}function aB(a,b){return"then"in a?a.then(b):b(a)}let aC={This:(b,a)=>a.value,Everything:(b,a)=>a.source,Parameter:({name:a},b)=>F(b.params[a]),Context({key:a},b){if("before"===a||"after"===a){let c=b.context[a];return c||k}throw new Error(`unknown context key: ${a}`)},Parent({n:c},d){let a=d;for(let b=0;b<c;b++){if(!a.parent)return k;a=a.parent}return a.value},OpCall({op:a,left:g,right:h},b,c){let d=ay[a];if(!d)throw new Error(`Unknown operator: ${a}`);let e=c(g,b),f=c(h,b);return"then"in e||"then"in f?(async()=>d(await e,await f))():d(e,f)},async Select({alternatives:f,fallback:c},a,b){for(let d of f){let e=await b(d.condition,a);if("boolean"===e.type&& !0===e.data)return b(d.value,a)}return c?b(c,a):k},async InRange({base:f,left:g,right:h,isInclusive:i},a,b){let e=await b(f,a),j=await b(g,a),l=await b(h,a),c=I(await e.get(),await j.get());if(null===c)return k;let d=I(await e.get(),await l.get());return null===d?k:i?c>=0&&d<=0?z:A:c>=0&&d<0?z:A},async Filter({base:a,expr:e},b,c){let d=await c(a,b);return d.isArray()?new y(async function*(){for await(let a of d){let g=b.createNested(a),f=await c(e,g);"boolean"===f.type&& !0===f.data&&(yield a)}}):k},async Projection({base:d,expr:e},a,b){let c=await b(d,a);if("object"!==c.type)return k;let f=a.createNested(c);return b(e,f)},FuncCall:({func:a,args:b},c,d)=>a(b,c,d),async PipeFuncCall({func:c,base:d,args:e},a,b){let f=await b(d,a);return c(f,e,a,b)},async AccessAttribute({base:b,name:c},d,e){let a=d.value;return(b&&(a=await e(b,d)),"object"===a.type&&a.data.hasOwnProperty(c))?F(a.data[c]):k},async AccessElement({base:d,index:a},e,f){let b=await f(d,e);if(!b.isArray())return k;let c=await b.get(),g=a<0?a+c.length:a;return F(c[g])},async Slice({base:e,left:f,right:g,isInclusive:h},i,j){let d=await j(e,i);if(!d.isArray())return k;let c=await d.get(),b=f,a=g;return b<0&&(b=c.length+b),a<0&&(a=c.length+a),h&&a++,b<0&&(b=0),a<0&&(a=0),F(c.slice(b,a))},async Deref({base:e},a,f){let c=await f(e,a);if(!a.source.isArray())return k;if("object"!==c.type)return k;let d=c.data._ref;if("string"!=typeof d)return k;for await(let b of a.source)if("object"===b.type&&d===b.data._id)return b;return k},Value:({value:a})=>F(a),Group:({base:a},b,c)=>c(a,b),async Object({attributes:h},b,c){let d={};for(let a of h){let i=a.type;switch(a.type){case"ObjectAttributeValue":{let j=await c(a.value,b);d[a.name]=await j.get();break}case"ObjectConditionalSplat":{let e=await c(a.condition,b);if("boolean"!==e.type|| !1===e.data)continue;let f=await c(a.value,b);"object"===f.type&&Object.assign(d,f.data);break}case"ObjectSplat":{let g=await c(a.value,b);"object"===g.type&&Object.assign(d,g.data);break}default:throw new Error(`Unknown node type: ${i}`)}}return F(d)},Array:({elements:a},b,c)=>new y(async function*(){for(let e of a){let d=await c(e.value,b);if(e.isSplat){if(d.isArray())for await(let f of d)yield f}else yield d}}),Tuple(){throw new Error("tuples can not be evaluated")},async Or({left:e,right:f},c,d){let a=await d(e,c),b=await d(f,c);return"boolean"===a.type&& !0===a.data?z:"boolean"===b.type&& !0===b.data?z:"boolean"!==a.type||"boolean"!==b.type?k:A},async And({left:e,right:f},c,d){let a=await d(e,c),b=await d(f,c);return"boolean"===a.type&& !1===a.data?A:"boolean"===b.type&& !1===b.data?A:"boolean"!==a.type||"boolean"!==b.type?k:z},async Not({base:b},c,d){let a=await d(b,c);return"boolean"!==a.type?k:a.data?A:z},Neg:({base:a},b,c)=>aB(c(a,b),a=>"number"!==a.type?k:C(-a.data)),Pos:({base:a},b,c)=>aB(c(a,b),a=>"number"!==a.type?k:C(a.data)),Asc:()=>k,Desc:()=>k,async ArrayCoerce({base:b},c,d){let a=await d(b,c);return a.isArray()?a:k},async Map({base:a,expr:e},b,c){let d=await c(a,b);return d.isArray()?new y(async function*(){for await(let a of d){let f=b.createHidden(a);yield await c(e,f)}}):k},async FlatMap({base:a,expr:e},b,c){let d=await c(a,b);return d.isArray()?new y(async function*(){for await(let f of d){let g=b.createHidden(f),a=await c(e,g);if(a.isArray())for await(let h of a)yield h;else yield a}}):k}};function aD(b,a={}){let c=F(a.root),d=F(a.dataset),e=s({},a.params),f=new l(e,d,c,{timestamp:a.timestamp||new Date,identity:void 0===a.identity?"me":a.identity,sanity:a.sanity,after:a.after?F(a.after):null,before:a.before?F(a.before):null},null);return aA(b,f)}let aE=new l({},k,k,{timestamp:new Date(0),identity:"me",before:null,after:null},null);class aF extends Error{constructor(){super(...arguments),this.name="ConstantEvaluateError"}}function aG(b){try{return aH(b)}catch(a){if("ConstantEvaluateError"===a.name)return null;throw a}}function aH(a){if(!function(a){switch(a.type){case"Group":case"Value":case"Parameter":case"Pos":case"Neg":return!0;case"OpCall":switch(a.op){case"+":case"-":case"*":case"/":case"%":case"**":return!0;default:return!1}default:return!1}}(a))throw new aF("cannot constant evaluate");let b=aA(a,aE,aH);if("then"in b)throw new Error("BUG: constant evaluate should never return a promise");return b}let aI={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function aJ(a){let b=parseInt(a,16);return String.fromCharCode(b)}class aK extends Error{constructor(){super(...arguments),this.name="GroqQueryError"}}let aL={group(a){let b=a.process(aL);return{type:"Group",base:b}},everything:()=>({type:"Everything"}),this:()=>({type:"This"}),parent:()=>({type:"Parent",n:1}),dblparent(a){let b=a.process(aL);return{type:"Parent",n:b.n+1}},traverse(b){let c=b.process(aL),d=[];for(;"traversal_end"!==b.getMark().name;)d.push(b.process(aN));b.shift();let a=null;for(let e=d.length-1;e>=0;e--)a=d[e](a);if(("Everything"===c.type||"Array"===c.type||"PipeFuncCall"===c.type)&&(a=av(a=>a,a)),null===a)throw new Error("BUG: unexpected empty traversal");return a.build(c)},this_attr(b){let a=b.processString();return"null"===a?{type:"Value",value:null}:"true"===a?{type:"Value",value:!0}:"false"===a?{type:"Value",value:!1}:{type:"AccessAttribute",name:a}},neg(a){let b=a.process(aL);return{type:"Neg",base:b}},pos(a){let b=a.process(aL);return{type:"Pos",base:b}},add(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"+",left:b,right:c}},sub(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"-",left:b,right:c}},mul(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"*",left:b,right:c}},div(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"/",left:b,right:c}},mod(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"%",left:b,right:c}},pow(a){let b=a.process(aL),c=a.process(aL);return{type:"OpCall",op:"**",left:b,right:c}},comp(a){let b=a.process(aL),c=a.processString(),d=a.process(aL);return{type:"OpCall",op:c,left:b,right:d}},in_range(a){let b=a.process(aL),c="inc_range"===a.getMark().name;a.shift();let d=a.process(aL),e=a.process(aL);return{type:"InRange",base:b,left:d,right:e,isInclusive:c}},str(a){let b="";loop:for(;a.hasMark();){let c=a.getMark();switch(c.name){case"str_end":b+=a.processStringEnd();break loop;case"str_pause":b+=a.processStringEnd();break;case"str_start":a.shift();break;case"single_escape":{let d=a.slice(1);a.shift(),b+=aI[d];break}case"unicode_hex":a.shift(),b+=aJ(a.processStringEnd());break;default:throw new Error(`unexpected mark: ${c.name}`)}}return{type:"Value",value:b}},integer(a){let b=a.processStringEnd();return{type:"Value",value:Number(b)}},float(a){let b=a.processStringEnd();return{type:"Value",value:Number(b)}},sci(a){let b=a.processStringEnd();return{type:"Value",value:Number(b)}},object(a){let b=[];for(;"object_end"!==a.getMark().name;)b.push(a.process(aM));return a.shift(),{type:"Object",attributes:b}},array(a){let b=[];for(;"array_end"!==a.getMark().name;){let c=!1;"array_splat"===a.getMark().name&&(c=!0,a.shift());let d=a.process(aL);b.push({type:"ArrayElement",value:d,isSplat:c})}return a.shift(),{type:"Array",elements:b}},tuple(a){let b=[];for(;"tuple_end"!==a.getMark().name;)b.push(a.process(aL));return a.shift(),{type:"Tuple",members:b}},func_call(a){let c="global";"namespace"===a.getMark().name&&(a.shift(),c=a.processString());let b=a.processString();if("global"===c&&"select"===b){let e={type:"Select",alternatives:[]};for(;"func_args_end"!==a.getMark().name;)if("pair"===a.getMark().name){if(e.fallback)throw new aK("unexpected argument to select()");a.shift();let h=a.process(aL),i=a.process(aL);e.alternatives.push({type:"SelectAlternative",condition:h,value:i})}else{if(e.fallback)throw new aK("unexpected argument to select()");let j=a.process(aL);e.fallback=j}return a.shift(),e}let f=[];for(;"func_args_end"!==a.getMark().name;)f.push(a.process(aL));if(a.shift(),"global"===c&&("before"===b||"after"===b)&&"delta"===a.parseOptions.mode)return{type:"Context",key:b};if("global"===c&&"boost"===b&&!a.allowBoost)throw new aK("unexpected boost");let g=W[c];if(!g)throw new aK(`Undefined namespace: ${c}`);let d=g[b];if(!d)throw new aK(`Undefined function: ${b}`);if(void 0!==d.arity&&aP(b,d.arity,f.length),void 0!==d.mode&&d.mode!==a.parseOptions.mode)throw new aK(`Undefined function: ${b}`);return{type:"FuncCall",func:d,name:b,args:f}},pipecall(a){let h=a.process(aL);a.shift();let f="global";if("namespace"===a.getMark().name&&(a.shift(),f=a.processString()),"global"!==f)throw new aK(`Undefined namespace: ${f}`);let b=a.processString(),c=[],i=a.allowBoost;for("score"===b&&(a.allowBoost=!0);;){let g=a.getMark().name;if("func_args_end"===g)break;if("order"===b){if("asc"===g){a.shift(),c.push({type:"Asc",base:a.process(aL)});continue}if("desc"===g){a.shift(),c.push({type:"Desc",base:a.process(aL)});continue}}c.push(a.process(aL))}a.shift(),a.allowBoost=i;let d=e[b];if(!d)throw new aK(`Undefined pipe function: ${b}`);return d.arity&&aP(b,d.arity,c.length),{type:"PipeFuncCall",func:d,base:h,name:b,args:c}},pair(a){throw new aK("unexpected =>")},and(a){let b=a.process(aL),c=a.process(aL);return{type:"And",left:b,right:c}},or(a){let b=a.process(aL),c=a.process(aL);return{type:"Or",left:b,right:c}},not(a){let b=a.process(aL);return{type:"Not",base:b}},asc(a){throw new aK("unexpected asc")},desc(a){throw new aK("unexpected desc")},param(a){let b=a.processString();return a.parseOptions.params&&a.parseOptions.params.hasOwnProperty(b)?{type:"Value",value:a.parseOptions.params[b]}:{type:"Parameter",name:b}}},aM={object_expr(a){if("pair"===a.getMark().name){a.shift();let c=a.process(aL),d=a.process(aL);return{type:"ObjectConditionalSplat",condition:c,value:d}}let b=a.process(aL);return{type:"ObjectAttributeValue",name:aO(b),value:b}},object_pair(a){let b=a.process(aL);if("Value"!==b.type)throw new Error("name must be string");let c=a.process(aL);return{type:"ObjectAttributeValue",name:b.value,value:c}},object_splat(a){let b=a.process(aL);return{type:"ObjectSplat",value:b}},object_splat_this:()=>({type:"ObjectSplat",value:{type:"This"}})},aN={square_bracket(b){let c=b.process(aL),a=aG(c);return a&&"number"===a.type?b=>(function(b,a){if(!a)return{type:"a-b",build:b};switch(a.type){case"a-a":case"b-a":return{type:"a-a",build:at(b,a.build)};case"a-b":case"b-b":return{type:"a-b",build:at(b,a.build)};default:throw new Error(`unknown type: ${a.type}`)}})(b=>({type:"AccessElement",base:b,index:a.data}),b):a&&"string"===a.type?b=>aw(b=>({type:"AccessAttribute",base:b,name:a.data}),b):a=>av(a=>({type:"Filter",base:a,expr:c}),a)},slice(a){let f="inc_range"===a.getMark().name;a.shift();let d=a.process(aL),e=a.process(aL),b=aG(d),c=aG(e);if(!b||!c||"number"!==b.type||"number"!==c.type)throw new aK("slicing must use constant numbers");return a=>av(a=>({type:"Slice",base:a,left:b.data,right:c.data,isInclusive:f}),a)},projection(a){let b=a.process(aL);return a=>(function(b,a){if(!a)return{type:"b-b",build:b};switch(a.type){case"a-a":return{type:"a-a",build:at(au(b),a.build)};case"a-b":return{type:"a-b",build:at(au(b),a.build)};case"b-a":return{type:"b-a",build:at(b,a.build)};case"b-b":return{type:"b-b",build:at(b,a.build)};default:throw new Error(`unknown type: ${a.type}`)}})(a=>({type:"Projection",base:a,expr:b}),a)},attr_access(a){let b=a.processString();return a=>aw(a=>({type:"AccessAttribute",base:a,name:b}),a)},deref(a){let b=null;"deref_attr"===a.getMark().name&&(a.shift(),b=a.processString());let c=a=>b?{type:"AccessAttribute",base:a,name:b}:a;return a=>aw(a=>c({type:"Deref",base:a}),a)},array_postfix:a=>a=>av(a=>({type:"ArrayCoerce",base:a}),a)};function aO(a){if("AccessAttribute"===a.type&&!a.base)return a.name;if("Deref"===a.type||"Map"===a.type||"Projection"===a.type||"Slice"===a.type||"Filter"===a.type||"AccessElement"===a.type||"ArrayCoerce"===a.type)return aO(a.base);throw new aK(`Cannot determine property key for type: ${a.type}`)}function aP(c,a,b){if("number"==typeof a){if(b!==a)throw new aK(`Incorrect number of arguments to function ${c}(). Expected ${a}, got ${b}.`)}else if(a&&!a(b))throw new aK(`Incorrect number of arguments to function ${c}().`)}class aQ extends Error{constructor(a){super(`Syntax error in GROQ query at position ${a}`),this.name="GroqSyntaxError",this.position=a}}function aR(e,f={}){var c;let b,a,d=(b=0,b=aq(c=e,b),a=al(c,b,0),"error"===a.type?a:(b=aq(c,a.position))!==c.length?(a.failPosition&&(b=a.failPosition-1),{type:"error",position:b}):(delete a.position,delete a.failPosition,a));if("error"===d.type)throw new aQ(d.position);let g=new t(e,d.marks,f);return g.process(aL)}},1619:function(d,b,a){"use strict";a.r(b),a.d(b,{applyPatch:function(){return q},incremental:function(){return c}});var c={};a.r(c),a.d(c,{applyPatch:function(){return o},getType:function(){return m},rebaseValue:function(){return n},unwrap:function(){return l},wrap:function(){return k}});var e=["Value","Copy","Blank","ReturnIntoArray","ReturnIntoObject","ReturnIntoObjectSameKey","PushField","PushElement","PushParent","Pop","PushFieldCopy","PushFieldBlank","PushElementCopy","PushElementBlank","ReturnIntoObjectPop","ReturnIntoObjectSameKeyPop","ReturnIntoArrayPop","ObjectSetFieldValue","ObjectCopyField","ObjectDeleteField","ArrayAppendValue","ArrayAppendSlice","StringAppendString","StringAppendSlice"],f=function(){function a(a,b,c){this.i=0,this.inputStack=[],this.outputStack=[],this.model=a,this.root=b,this.patch=c}return a.prototype.read=function(){return this.patch[this.i++]},a.prototype.process=function(){for(this.inputStack.push({value:this.root}),this.outputStack.push({value:this.root});this.i<this.patch.length;){var a=this.read(),b=e[a];if(!b)throw new Error("Unknown opcode: "+a);this["process"+b].apply(this)}var c=this.outputStack.pop();return this.finalizeOutput(c)},a.prototype.inputEntry=function(){return this.inputStack[this.inputStack.length-1]},a.prototype.inputKey=function(a,b){return a.keys||(a.keys=this.model.objectGetKeys(a.value).sort()),a.keys[b]},a.prototype.outputEntry=function(){return this.outputStack[this.outputStack.length-1]},a.prototype.outputArray=function(){var a=this.outputEntry();return a.writeValue||(a.writeValue=this.model.copyArray(a.value)),a.writeValue},a.prototype.outputObject=function(){var a=this.outputEntry();return a.writeValue||(a.writeValue=this.model.copyObject(a.value)),a.writeValue},a.prototype.outputString=function(){var a=this.outputEntry();return a.writeValue||(a.writeValue=this.model.copyString(a.value)),a.writeValue},a.prototype.finalizeOutput=function(a){return a.writeValue?this.model.finalize(a.writeValue):a.value},a.prototype.processValue=function(){var a=this.model.wrap(this.read());this.outputStack.push({value:a})},a.prototype.processCopy=function(){var a=this.inputEntry();this.outputStack.push({value:a.value})},a.prototype.processBlank=function(){this.outputStack.push({value:null})},a.prototype.processReturnIntoArray=function(){var a=this.outputStack.pop(),b=this.finalizeOutput(a),c=this.outputArray();this.model.arrayAppendValue(c,b)},a.prototype.processReturnIntoObject=function(){var b=this.read(),c=this.outputStack.pop(),a=this.finalizeOutput(c);a=this.model.markChanged(a);var d=this.outputObject();this.model.objectSetField(d,b,a)},a.prototype.processReturnIntoObjectSameKey=function(){var a=this.inputEntry(),b=this.outputStack.pop(),c=this.finalizeOutput(b),d=this.outputObject();this.model.objectSetField(d,a.key,c)},a.prototype.processPushField=function(){var c=this.read(),a=this.inputEntry(),b=this.inputKey(a,c),d=this.model.objectGetField(a.value,b);this.inputStack.push({value:d,key:b})},a.prototype.processPushElement=function(){var a=this.read(),b=this.inputEntry(),c=this.model.arrayGetElement(b.value,a);this.inputStack.push({value:c})},a.prototype.processPop=function(){this.inputStack.pop()},a.prototype.processPushFieldCopy=function(){this.processPushField(),this.processCopy()},a.prototype.processPushFieldBlank=function(){this.processPushField(),this.processBlank()},a.prototype.processPushElementCopy=function(){this.processPushElement(),this.processCopy()},a.prototype.processPushElementBlank=function(){this.processPushElement(),this.processBlank()},a.prototype.processReturnIntoObjectPop=function(){this.processReturnIntoObject(),this.processPop()},a.prototype.processReturnIntoObjectSameKeyPop=function(){this.processReturnIntoObjectSameKey(),this.processPop()},a.prototype.processReturnIntoArrayPop=function(){this.processReturnIntoArray(),this.processPop()},a.prototype.processObjectSetFieldValue=function(){this.processValue(),this.processReturnIntoObject()},a.prototype.processObjectCopyField=function(){this.processPushField(),this.processCopy(),this.processReturnIntoObjectSameKey(),this.processPop()},a.prototype.processObjectDeleteField=function(){var a=this.read(),b=this.inputEntry(),c=this.inputKey(b,a),d=this.outputObject();this.model.objectDeleteField(d,c)},a.prototype.processArrayAppendValue=function(){var a=this.model.wrap(this.read()),b=this.outputArray();this.model.arrayAppendValue(b,a)},a.prototype.processArrayAppendSlice=function(){var a=this.read(),b=this.read(),c=this.outputArray(),d=this.inputEntry().value;this.model.arrayAppendSlice(c,d,a,b)},a.prototype.processStringAppendString=function(){var a=this.model.wrap(this.read()),b=this.outputString();this.model.stringAppendValue(b,a)},a.prototype.processStringAppendSlice=function(){var a=this.read(),b=this.read(),c=this.outputString(),d=this.inputEntry().value;this.model.stringAppendSlice(c,d,a,b)},a}();function g(a){return a>>16?4:a>>11?3:a>>7?2:1}function h(b){for(var c=0,a=0;a<b.length;a++){var d=g(b.codePointAt(a));4==d&&a++,c+=d}return c}function i(e,f,b){void 0===b&&(b=0);var c=b,a=0;for(a=b;c<f;a++){var d=g(e.codePointAt(a));4===d&&a++,c+=d}return a}var j=function(){function a(a){this.meta=a}return a.prototype.wrap=function(a){return this.wrapWithMeta(a,this.meta,this.meta)},a.prototype.wrapWithMeta=function(b,c,a){return void 0===a&&(a=this.meta),{data:b,startMeta:c,endMeta:a}},a.prototype.asObject=function(a){if(!a.content){for(var c={},b=0,d=Object.entries(a.data);b<d.length;b++){var e=d[b],f=e[0],g=e[1];c[f]=this.wrapWithMeta(g,a.startMeta)}a.content={type:"object",fields:c}}return a.content},a.prototype.asArray=function(a){var d=this;if(!a.content){var b=a.data.map(function(b){return d.wrapWithMeta(b,a.startMeta)}),c=b.map(function(){return d.meta});a.content={type:"array",elements:b,metas:c}}return a.content},a.prototype.asString=function(a){if(!a.content){var b=a.data,c={value:b,utf8size:h(b),uses:[],startMeta:a.startMeta,endMeta:a.endMeta};a.content=this.stringFromParts([c])}return a.content},a.prototype.stringFromParts=function(b){for(var c={type:"string",parts:b},a=0,d=b;a<d.length;a++)d[a].uses.push(c);return c},a.prototype.objectGetKeys=function(a){return a.content?Object.keys(a.content.fields):Object.keys(a.data)},a.prototype.objectGetField=function(a,b){return this.asObject(a).fields[b]},a.prototype.arrayGetElement=function(a,b){return this.asArray(a).elements[b]},a.prototype.finalize=function(a){return this.updateEndMeta(a),{content:a,startMeta:this.meta,endMeta:this.meta}},a.prototype.markChanged=function(a){return this.wrap(l(a))},a.prototype.updateEndMeta=function(b){if("string"==b.type)for(var c=0,f=b.parts;c<f.length;c++)f[c].endMeta=this.meta;else if("array"===b.type)for(var d=0,g=b.elements;d<g.length;d++){var a=g[d];a.content&&a.endMeta!==this.meta&&this.updateEndMeta(a.content),a.endMeta=this.meta}else for(var e=0,h=Object.values(b.fields);e<h.length;e++){var a=h[e];a.content&&a.endMeta!==this.meta&&this.updateEndMeta(a.content),a.endMeta=this.meta}},a.prototype.copyString=function(a){if(!a)return{type:"string",parts:[]};var b=this.asString(a);return this.stringFromParts(b.parts.slice())},a.prototype.copyObject=function(a){var b={type:"object",fields:{}};if(a){var c=this.asObject(a);Object.assign(b.fields,c.fields)}return b},a.prototype.copyArray=function(b){var a=b?this.asArray(b):null,c=a?a.elements:[],d=a?a.metas:[];return{type:"array",elements:c,metas:d}},a.prototype.objectSetField=function(a,b,c){a.fields[b]=c},a.prototype.objectDeleteField=function(a,b){delete a.fields[b]},a.prototype.arrayAppendValue=function(a,b){a.elements.push(b),a.metas.push(this.meta)},a.prototype.arrayAppendSlice=function(b,h,a,c){var e,f,d=this.asArray(h),i=d.elements.length===a;if((e=b.elements).push.apply(e,d.elements.slice(a,c)),i)(f=b.metas).push.apply(f,d.metas.slice(a,c));else for(var g=a;g<c;g++)b.metas.push(this.meta)},a.prototype.stringAppendValue=function(c,d){for(var e=this.asString(d),a=0,b=e.parts;a<b.length;a++){var f=b[a];this.stringAppendPart(c,f)}},a.prototype.stringAppendPart=function(a,b){a.parts.push(b),b.uses.push(a)},a.prototype.resolveStringPart=function(d,e,a){if(0===a)return e;for(var b=e;b<d.parts.length;b++){var c=d.parts[b];if(a===c.utf8size)return b+1;if(a<c.utf8size)return this.splitString(c,a),b+1;a-=c.utf8size}throw new Error("splitting string out of bounds")},a.prototype.splitString=function(a,b){var e,n,c=b,l=a.utf8size-c;if(a.utf8size!==a.value.length){var f=0;for(b=0;f<c;b++){var h=g(a.value.codePointAt(b));4===h&&b++,f+=h}}e=a.value.slice(0,b);var m={value:a.value.slice(b),utf8size:l,uses:a.uses.slice(),startMeta:a.startMeta,endMeta:a.endMeta};a.value=e,a.utf8size=c;for(var d=0,i=a.uses;d<i.length;d++){var j=i[d],k=j.parts.indexOf(a);if(-1===k)throw new Error("bug: mismatch between string parts and use.");j.parts.splice(k+1,0,m)}},a.prototype.stringAppendSlice=function(e,f,c,g){for(var a=this.asString(f),d=this.resolveStringPart(a,0,c),h=this.resolveStringPart(a,d,g-c),b=d;b<h;b++){var i=a.parts[b];this.stringAppendPart(e,i)}},a}();function k(b,a){return{data:b,startMeta:a,endMeta:a}}function l(b){if(void 0!==b.data)return b.data;var a,c=b.content;switch(c.type){case"string":a=c.parts.map(function(a){return a.value}).join("");break;case"array":a=c.elements.map(function(a){return l(a)});break;case"object":a={};for(var d=0,e=Object.entries(c.fields);d<e.length;d++){var f=e[d],g=f[0],h=f[1];a[g]=l(h)}}return b.data=a,a}function m(a){return a.content?a.content.type:Array.isArray(a.data)?"array":null===a.data?"null":typeof a.data}function n(a,b){var w=m(a);if(w!==m(b))return b;var x=new j(a.endMeta),c=new j(b.endMeta);switch(w){case"object":for(var y=x.asObject(a),k=c.asObject(b),z=0,A=Object.keys(y.fields).length,G=Object.keys(k.fields).length,s=0,B=Object.entries(k.fields);s<B.length;s++){var C=B[s],t=C[0],H=C[1],u=y.fields[t];u&&(k.fields[t]=n(u,H),k.fields[t]===u&&z++)}return A===G&&A===z?a:b;case"array":var v=x.asArray(a),e=c.asArray(b);if(v.elements.length!==e.elements.length)break;for(var D=0,d=0;d<e.elements.length;d++)e.elements[d]=n(v.elements[d],e.elements[d]),e.elements[d]!==v.elements[d]&&D++;return 0===D?a:b;case"null":case"boolean":case"number":if(l(a)===l(b))return a;break;case"string":var o=l(a),f=l(b);if(o===f)return a;var p=c.copyString(null),i=function(c,d){for(var h=Math.min(c.length,d.length),b=0,a=0;a<h;){var e=c.codePointAt(a);if(e!==d.codePointAt(a))return b;var f=g(e);b+=f,a+=4===f?2:1}return b}(o,f),q=function(b,c,d){void 0===d&&(d=0);for(var i=Math.min(b.length,c.length)-d,e=0,a=0;a<i;){var f=b.codePointAt(b.length-1-a);if(f!==c.codePointAt(c.length-1-a))return e;var h=g(f);e+=h,a+=4===h?2:1}return e}(o,f,i),E=h(f),r=h(o);0<i&&c.stringAppendSlice(p,a,0,i),i<E-q&&c.stringAppendSlice(p,b,i,E-q),r-q<r&&c.stringAppendSlice(p,a,r-q,r);var F=c.finalize(p);if(l(F)!==f)throw new Error("incorrect string rebase");return F}return b}function o(a,b,c){var d=new j(c);return new f(d,a,b).process()}var p={wrap:function(a){return a},finalize:function(a){return Array.isArray(a)?a:a.data},markChanged:function(a){return a},objectGetKeys:function(a){return Object.keys(a)},objectGetField:function(a,b){return a[b]},arrayGetElement:function(a,b){return a[b]},copyObject:function(b){var c={type:"object",data:{}};if(null!==b)for(var a=0,d=Object.entries(b);a<d.length;a++){var e=d[a],f=e[0],g=e[1];c.data[f]=g}return c},copyArray:function(a){return null===a?[]:a.slice()},copyString:function(a){return{type:"string",data:null===a?"":a}},objectSetField:function(a,b,c){a.data[b]=c},objectDeleteField:function(a,b){delete a.data[b]},arrayAppendValue:function(a,b){a.push(b)},arrayAppendSlice:function(a,b,c,d){a.push.apply(a,b.slice(c,d))},stringAppendSlice:function(c,d,e,f){var a=d,b=i(a,e),g=i(a,f,b);c.data+=a.slice(b,g)},stringAppendValue:function(a,b){a.data+=b}};function q(a,b){return new f(p,a,b).process()}},2189:function(c,a){"use strict";function b(e,a,b,d){var f,g=!1,h=0;function i(){f&&clearTimeout(f)}function c(){for(var k=arguments.length,m=new Array(k),c=0;c<k;c++)m[c]=arguments[c];var n=this,l=Date.now()-h;function j(){h=Date.now(),b.apply(n,m)}g||(d&&!f&&j(),i(),void 0===d&&l>e?j():!0!==a&&(f=setTimeout(d?function(){f=void 0}:j,void 0===d?e-l:e)))}return"boolean"!=typeof a&&(d=b,b=a,a=void 0),c.cancel=function(){i(),g=!0},c}Object.defineProperty(a,"__esModule",{value:!0}),a.debounce=function(a,c,d){return void 0===d?b(a,c,!1):b(a,d,!1!==c)},a.throttle=b}}])